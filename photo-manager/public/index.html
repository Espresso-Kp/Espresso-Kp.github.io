<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>📸 Island Gallery - 照片管理</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <div class="container">
        <!-- 头部 -->
        <header class="header">
            <h1>📸 Island Gallery</h1>
            <p class="subtitle">照片管理系统</p>
            <div class="header-actions">
                <button class="btn btn-primary" onclick="showUploadModal()">
                    <span>➕</span> 上传照片
                </button>
                <button class="btn btn-secondary" onclick="showCategoryModal()">
                    <span>📁</span> 分类管理
                </button>
                <button class="btn btn-secondary" onclick="showGitPanel()">
                    <span>🔄</span> Git 操作
                </button>
            </div>
        </header>

        <!-- 过滤器 -->
        <div class="filters">
            <select id="categoryFilter" onchange="filterPhotos()">
                <option value="">所有分类</option>
                <!-- 动态加载 -->
            </select>
            <input type="text" id="searchInput" placeholder="搜索标题或标签..." oninput="filterPhotos()">
            <span class="photo-count">共 <span id="photoCount">0</span> 张照片</span>
        </div>

        <!-- 照片网格 -->
        <div id="photoGrid" class="photo-grid">
            <div class="loading">加载中...</div>
        </div>

        <!-- Git 面板 -->
        <div id="gitPanel" class="modal" style="display: none;">
            <div class="modal-content">
                <span class="close" onclick="closeGitPanel()">&times;</span>
                <h2>Git 操作</h2>

                <div class="git-section">
                    <h3>当前状态</h3>
                    <button class="btn btn-secondary" onclick="checkGitStatus()">检查状态</button>
                    <pre id="gitStatus" class="git-output">点击"检查状态"查看...</pre>
                </div>

                <div class="git-section">
                    <h3>提交更改</h3>
                    <input type="text" id="commitMessage" placeholder="提交信息（例如：Add new photos）" value="Update photos">
                    <button class="btn btn-primary" onclick="gitCommit()">提交</button>
                    <pre id="commitOutput" class="git-output"></pre>
                </div>

                <div class="git-section">
                    <h3>推送到 GitHub</h3>
                    <button class="btn btn-success" onclick="gitPush()">推送</button>
                    <pre id="pushOutput" class="git-output"></pre>
                </div>
            </div>
        </div>

        <!-- 上传模态框 -->
        <div id="uploadModal" class="modal" style="display: none;">
            <div class="modal-content">
                <span class="close" onclick="closeUploadModal()">&times;</span>
                <h2>上传照片</h2>

                <form id="uploadForm" onsubmit="uploadPhoto(event)">
                    <div class="form-group">
                        <label>选择图片 *</label>
                        <input type="file" id="imageFile" accept="image/*" required onchange="previewImage(event)">
                        <div id="imagePreview" class="image-preview"></div>
                    </div>

                    <div class="form-group">
                        <label>分类 *</label>
                        <select id="uploadCategory" required>
                            <!-- 动态加载 -->
                        </select>
                    </div>

                    <div class="form-group">
                        <label>标题（可选）</label>
                        <input type="text" id="uploadTitle" placeholder="照片标题">
                    </div>

                    <div class="form-group">
                        <label>额外标签（可选）</label>
                        <input type="text" id="uploadTags" placeholder="用逗号分隔，例如：landscape, sunset">
                    </div>

                    <div class="form-group">
                        <label>文案描述（可选）</label>
                        <textarea id="uploadContent" rows="4" placeholder="添加照片的描述文案..."></textarea>
                        <small>支持 Markdown 格式</small>
                    </div>

                    <div class="form-actions">
                        <button type="submit" class="btn btn-primary">上传</button>
                        <button type="button" class="btn btn-secondary" onclick="closeUploadModal()">取消</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- 编辑模态框 -->
        <div id="editModal" class="modal" style="display: none;">
            <div class="modal-content">
                <span class="close" onclick="closeEditModal()">&times;</span>
                <h2>编辑照片信息</h2>

                <form id="editForm" onsubmit="saveEdit(event)">
                    <input type="hidden" id="editPhotoId">

                    <div class="form-group">
                        <label>分类 *</label>
                        <select id="editCategory" required>
                            <!-- 动态加载 -->
                        </select>
                        <small>修改分类会移动文件到新分类目录</small>
                    </div>

                    <div class="form-group">
                        <label>标题</label>
                        <input type="text" id="editTitle">
                    </div>

                    <div class="form-group">
                        <label>标签</label>
                        <input type="text" id="editTags" placeholder="用逗号分隔">
                        <small>当前标签会自动填充</small>
                    </div>

                    <div class="form-group">
                        <label>文案描述（可选）</label>
                        <textarea id="editContent" rows="4" placeholder="添加照片的描述文案..."></textarea>
                        <small>支持 Markdown 格式</small>
                    </div>

                    <div class="form-group">
                        <label>权重（排序）</label>
                        <input type="number" id="editWeight" min="1" value="1">
                        <small>数字越小越靠前</small>
                    </div>

                    <div class="form-actions">
                        <button type="submit" class="btn btn-primary">保存</button>
                        <button type="button" class="btn btn-secondary" onclick="closeEditModal()">取消</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- 分类管理模态框 -->
        <div id="categoryModal" class="modal" style="display: none;">
            <div class="modal-content">
                <span class="close" onclick="closeCategoryModal()">&times;</span>
                <h2>📁 分类管理</h2>

                <div class="category-add-section">
                    <input type="text" id="newCategoryName" placeholder="新分类名称 (例如: car)">
                    <button class="btn btn-primary" onclick="addCategory()">新建分类</button>
                </div>

                <div class="category-list-container">
                    <h3>现有分类</h3>
                    <ul id="categoryList" class="category-list">
                        <!-- 动态加载 -->
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <script src="app.js"></script>
</body>

</html>